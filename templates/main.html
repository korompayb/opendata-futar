<!DOCTYPE html>
<html lang="hu" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BKK FUTAR</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='menetrend.css') }}">
    <style>
        .stop-navigation {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .stop-navigation button {
            margin: 0 10px;
            background-color: transparent;
            border-color: transparent;
        }

        .highlight {
            font-weight: bold;
        }

        .card {
            width: 32em;
            height: 13em;
            margin-left: auto;
            margin-right: auto;
        }

        .headline {
            background-color: #42456C;
            width: 100%;
            height: 20%;
        }

        .box {
            background-color: #212144;
            width: 100%;
            
        }

        .card-body {
            background-color: #212144;
            outline: #131313 15px solid;
            border-radius: 5px;
            padding: 0px !important;
        }
        
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">BKK FUTAR Display</h1>
        <div class="card mt-5 ">
            <div class="card-body">
            <div class="headline position-static" style="z-index: 0;">

            </div>
            <div>
                <div style="padding-left: 10px;">
                    <div class="position-absolute  d-flex justify-content-center align-items-center" style="top: 0.2em; z-index: 4; border-radius: 5px; background-color:#{{ route_info.color }} !important; width: 45px; height: 30px;">
                        <text style="font-weight: bold; color: #{{ route_info.textColor }};">{{ route_info.shortName }}</text>
                    </div>
                </div>
            </div>
                
                
                <span class=" position-absolute top-0 end-0" id="currentTime" style="padding: 2%; font-weight: bold; float: right;"></span>
                
                <div style="padding-left: 60px; margin-top: -2em;">
                    <svg style="position: absolute;" width="25" height="125" viewBox="0 0 65 401" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M65 93H0L18.5 59L11.6507 53.5206C6.39606 49.3168 2.84479 43.3496 1.65597 36.7261C0.581711 30.741 1.49977 24.5686 4.26943 19.1552L4.84787 18.0246C8.76942 10.3598 15.735 4.6786 24.0279 2.3643C29.5574 0.821183 35.4662 0.868143 40.9758 2.48072C48.64 4.72391 55.181 9.9077 59.073 16.8809L59.5903 17.8076C63.0633 24.0301 64.013 31.3492 62.243 38.2521C60.7852 43.9377 57.5645 49.0156 53.0427 52.7578L45.5 59L65 93Z" fill="#{{ route_info.color }}"/>
                        <rect x="16" y="99" width="32" height="9" fill="#{{ route_info.color }}"/>
                        <rect x="16" y="115" width="32" height="9" fill="#{{ route_info.color }}"/>
                        <rect x="17" y="130" width="31" height="265" fill="#{{ route_info.color }}"/>
                        <circle cx="32.5" cy="178.5" r="26.5" fill="#D9D9D9" stroke="#{{ route_info.color }}" stroke-width="12"/>
                        <circle cx="32.5" cy="273.5" r="26.5" fill="#D9D9D9" stroke="#{{ route_info.color }}" stroke-width="12"/>
                        <circle cx="32.5" cy="368.5" r="26.5" fill="#D9D9D9" stroke="#{{ route_info.color }}" stroke-width="12"/>
                    </svg>
                    <ul class="line line--m2" style="--line-color: #{{ route_info.color }} !important;">
                        <!-- Terminus at the top -->
                        <li class="station station--start">
                            
                            <h4 class="stop-name label" style="width: 80%;">{{ trip_info.tripHeadsign }}</h4>
                            <span class="arrival-time"></span>
                        </li>
                        <!-- Placeholder for stop list items -->
                        {% for stop in stops[current_stop_index:current_stop_index + 3]|reverse %}
                            <li class="station station--default">
                                <span class="stop-name">{{ stop.name }}</span>
                                <span class="arrival-time">{{ stop.arrival_time }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                
            </div>
        </div>
        <div class="stop-navigation">
            <button class="btn btn-primary" id="prevBtn">▼</button>
            <button class="btn btn-primary" id="nextBtn">▲</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stops = {{ stops|tojson }};
            let currentIndex = {{ current_stop_index }};
            const maxStops = 3;  // Number of stops to display

            const routeColor = "{{ route_info.color }}";  // Extracted color from JSON

            // Set the CSS variable --line-color
            document.documentElement.style.setProperty('--line-color', `#${routeColor}`);

            function updateStopsDisplay() {
                // Always show the terminus at the top
                const terminus = stops[stops.length - 1];
                document.querySelector('.station--start .stop-name').textContent = terminus?.name || '';
                document.querySelector('.station--start .arrival-time').textContent = terminus?.arrival_time || '';

                // Determine the next stops from the current index
                const nextStops = stops.slice(currentIndex, currentIndex + maxStops).reverse();

                // Update the stations below the terminus
                document.querySelectorAll('.station--default').forEach((station, index) => {
                    const stop = nextStops[index] || {}; // Default to empty object if no stop
                    station.querySelector('.stop-name').textContent = stop?.name || '';
                    station.querySelector('.arrival-time').textContent = stop?.arrival_time || '';
                });

                // Highlight the current stop
                document.querySelectorAll('.station--default').forEach(station => {
                    station.classList.remove('highlight');
                });
                
                if (nextStops.length > 0) {
                    const lastStopIndex = nextStops.length - 0;
                    document.querySelector(`.station--default:nth-child(${lastStopIndex + 1}) .stop-name`).classList.add('highlight');
                }
            }

            function updateCurrentTime() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeString = `${hours}:${minutes}`;
                document.getElementById('currentTime').textContent = timeString;
            }

            // Update the time every minute
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);

            document.getElementById('prevBtn').addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateStopsDisplay();
                }
            });

            document.getElementById('nextBtn').addEventListener('click', () => {
                if (currentIndex < stops.length - maxStops) {
                    currentIndex++;
                    updateStopsDisplay();
                }
            });

            updateStopsDisplay();
        });
    </script>
</body>

</html>
